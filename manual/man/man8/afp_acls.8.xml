<?xml version="1.0" encoding="UTF-8"?>
<refentry id="afp_acls.8">
  <refmeta>
    <refentrytitle>afp_acls</refentrytitle>

    <manvolnum>8</manvolnum>

    <refmiscinfo class="date">20 Oct 2010</refmiscinfo>

    <refmiscinfo class="source">:NETATALK_VERSION:</refmiscinfo>
  </refmeta>

  <refnamediv>
    <refname>afp_acls</refname>

    <refpurpose>Setup and Usage Howto for ACLs with Netatalk</refpurpose>
  </refnamediv>

  <refsect1>
    <title>Description</title>

    <para>ACL support for AFP is implemented with NFSv4 ACLs. Few filesystems
    and fewer OSes support these. At the time of implementation its only
    provided with ZFS on Solaris, Opensolaris and derived
    distributions.</para>
  </refsect1>

  <refsect1>
    <title>Configuration</title>

    <para>In order to be able to support ACLs, the following things have to be
    configured:</para>

    <orderedlist>
      <listitem>
        <para>ZFS Volumes</para>

        <para>You MUST configure one ACL parameter for any volume you want to
        use with Netatalk: <programlisting>aclinherit = passthrough</programlisting></para>

        <para> For an explanation of what this parameter means and how to
        apply it see, your hosts ZFS documentation (e.g. man zfs).</para>
      </listitem>

      <listitem>
        <para>Authentication Domain</para>

        <para>Your server and the clients must be part of a security
        association where identity data is coming from a common source. ACLs
        in Darwin are based on UUIDs and so is the ACL specification in AFP
        3.2. Therefor your source of identity data has to provide an attribute
        for every user and group where a UUID is stored as a ASCII
        string.</para>

        <para>In other words:<itemizedlist>
            <listitem>
              <para>you need an Open Directory Server or an LDAP server where
              you store UUIDs in some attribute</para>
            </listitem>

            <listitem>
              <para>your clients must be configured to use this server</para>
            </listitem>

            <listitem>
              <para>your server should be configured to use this server via
              nsswitch and PAM.</para>
            </listitem>

            <listitem>
              <para>configure Netatalk via afp_ldap.conf so that Netatalk is able
              to retrieve the UUID for users and groups via LDAP search
              queries</para>
            </listitem>
          </itemizedlist></para>
      </listitem>

      <listitem>
        <para>Netatalk Volumes</para>

        <para>Finally you can add <option>options:acls</option> to your volume
        defintion to add ACL support. In case your volume basedir doesn't
        grant read permissions via mode (like: <command>0700
        root:adm</command>) but only via ACLs, you MUST add the
        <option>nostat</option> option to the volume defintion.</para>
      </listitem>
    </orderedlist>
  </refsect1>

  <refsect1>
    <title>SEE ALSO</title>

    <para><citerefentry>
        <refentrytitle>afp_ldap.conf</refentrytitle>

        <manvolnum>5</manvolnum>
      </citerefentry>, <citerefentry>
        <refentrytitle>AppleVolumes.default</refentrytitle>

        <manvolnum>5</manvolnum>
      </citerefentry></para>
  </refsect1>
</refentry>
